--- 
  - name: install r1soft agent f
    hosts: target
    become: yes
    become_method: sudo
    tasks:
      - block:
        - name: create repository 
          copy: 
            src: r1soft.repo
            dest: /etc/yum.repos.d/r1soft.repo
        
        - name: install r1soft agent
          package: 
            name: serverbackup-enterprise-agent
            state: latest 
          notify: R1SOFT_INSTALLED_ON_CENTOS7
          
        - name: get key
          shell: "r1soft-setup --get-key http://r1soft.acirrustech.com"
        when: ansible_distribution == "CentOS" and ansible_distribution_major_version == "7"
    
    
            
            

#this block of code is for centos6
      - block:
        - name: create repository 
          copy: 
            src: r1soft.repo
            dest: /etc/yum.repos.d/r1soft.repo
        
        - name: install r1soft agent
          package: 
            name: serverbackup-enterprise-agent
            state: latest 
          notify: R1SOFT_INSTALLED_ON_CENTOS6  

        - name: start agent
          service:
            name: cdp-agent
            state: restarted
          notify: R1SOFT_INSTALLED_ON_FEDORA  
        
        - name: get key
          shell: "r1soft-setup --get-key http://r1soft.acirrustech.com"
        when: ansible_distribution == "CentOS" and ansible_distribution_major_version == "6"

#this block of code is for centos 8
      - block:
        - name: create repository 
          copy: 
            src: r1soft.repo
            dest: /etc/yum.repos.d/r1soft.repo
        
        - name: install r1soft agent
          package: 
            name: serverbackup-enterprise-agent
            state: latest 
          notify: R1SOFT_INSTALLED_ON_CENTOS8

        - name: start agent
          systemd:
            name: sbm-agent
            state: restarted
        
        - name: get key
          shell: "r1soft-setup --get-key http://r1soft.acirrustech.com"
        when: ansible_distribution == "CentOS" and ansible_distribution_major_version == "8"

#this block of code is for fedora
      - block:
        - name: create repository 
          copy: 
            src: r1soft.repo
            dest: /etc/yum.repos.d/r1soft.repo
        
        - name: install r1soft agent
          package: 
            name: serverbackup-enterprise-agent
            state: latest 
          notify: R1SOFT_INSTALLED_ON_FEDORA

        - name: start agent
          systemd:
            name: sbm-agent
            state: restarted
        
        - name: get key
          shell: "r1soft-setup --get-key http://r1soft.acirrustech.com"
        when: ansible_distribution == "Fedora" and ansible_distribution_major_version == "28"


  handlers:
      - name: R1SOFT_INSTALLED_ON_CENTOS7
        systemd:
            name: sbm-agent
            state: restarted 
      - name: R1SOFT_INSTALLED_ON_CENTOS6
        service:
            name: cdp-agent
            state: restarted   
      - name: R1SOFT_INSTALLED_ON_CENTOS8
        systemd:
            name: sbm-agent
            state: restarted
      - name: R1SOFT_INSTALLED_ON_FEDORA
        systemd:
            name: sbm-agent
            state: restarted      

